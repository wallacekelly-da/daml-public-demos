services:

  domain1:
    container_name: domain1
    image: digitalasset-docker.jfrog.io/canton-enterprise:2.10.0-rc1
    volumes:
      - ./configs:/canton/host/configs:r
    command: daemon --config "/canton/host/configs/domain1.conf" --log-profile container --log-level-root INFO

  participant1:
    container_name: participant1
    image: digitalasset-docker.jfrog.io/canton-enterprise:2.10.0-rc1
    volumes:
      - ./configs:/canton/host/configs:r
      - ./Assets1/AssetModels/.daml/dist:/canton/host/dist:r
    command: daemon --config "/canton/host/configs/participant1.conf" --bootstrap "/canton/host/configs/participant1.canton" --log-profile container --log-level-root INFO
    healthcheck:
      test: [ "CMD", "/usr/local/bin/grpc_health_probe", "--addr", "participant1:5861" ]
    depends_on:
      - domain1
    ports:
      - 4001:4001

  httpjson1:
    container_name: httpjson1
    image: digitalasset-docker.jfrog.io/http-json:2.10.0-snapshot.20241217.13156.0.v1da3a35b
    volumes:
      - ./configs:/canton/host/configs:r
    command: --config "/canton/host/configs/httpjson1.conf"
    ports:
      - 7575:7575
    depends_on:
      participant1:
        condition: service_healthy
  #
  # pqsdb1:
  #   container_name: pqsdb1
  #   image: postgres:16
  #   environment:
  #     - POSTGRES_PASSWORD=postgres
  #     - POSTGRES_USERNAME=postgres
  #     - POSTGRES_DATABASE=postgres
  #   healthcheck:
  #     test: [ "CMD-SHELL", "pg_isready -d postgres -U postgres" ]
  #   ports:
  #     - 5432:5432

  # pqs1:
  #   container_name: pqs1
  #   image: digitalasset-docker.jfrog.io/participant-query-store:0.5.4
  #   volumes:
  #     - ./configs:/canton/host/configs:r
  #   command: pipeline ledger postgres-document --config /canton/host/configs/pqs1.conf --pipeline-datasource TransactionTreeStream --pipeline-ledger-start Genesis
  #   environment:
  #     - OTEL_JAVAAGENT_ENABLED=false
  #   depends_on:
  #     pqsdb1:
  #       condition: service_healthy
  #     participant1:
  #       condition: service_healthy
